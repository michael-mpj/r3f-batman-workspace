name: "Setup Workspace"
description: "Setup Node.js environment and install workspace dependencies"
inputs:
  node-version:
    description: "Node.js version to use"
    required: false
    default: "20"
  cache-dependency-path:
    description: "Path to package-lock.json or yarn.lock file"
    required: false
    default: "**/package-lock.json"
  skip-install:
    description: "Skip npm install step"
    required: false
    default: "false"

runs:
  using: "composite"
  steps:
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node-version }}
        cache: "npm"
        cache-dependency-path: ${{ inputs.cache-dependency-path }}

    - name: Install dependencies
      if: inputs.skip-install != 'true'
      shell: bash
      run: |
        echo "Installing workspace dependencies..."
        npm ci --prefer-offline --no-audit

    - name: Verify workspace structure
      shell: bash
      run: |
        echo "Workspace structure:"
        npm ls --depth=0 --workspaces

    - name: Cache node_modules
      uses: actions/cache@v4
      with:
        path: |
          node_modules
          */node_modules
          packages/*/node_modules
        key: ${{ runner.os }}-node-modules-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-node-modules-
